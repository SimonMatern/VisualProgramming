<!DOCTYPE html>
<html lang="en">

<head>
    <title>Visual Programming</title>
    <script src="{{ url_for('static', filename='js/cytoscape.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/modal.js') }}"></script>
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}" type="text/css">
    <link rel="stylesheet" href="{{ url_for('static', filename='navbar.css') }}">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/js/standalone/selectize.min.js"></script>
    <script src="https://cdn.rawgit.com/cpettitt/dagre/v0.7.4/dist/dagre.min.js"></script>
    <script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-dagre/1.5.0/cytoscape-dagre.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/css/selectize.default.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap-datepicker.standalone.min.css') }}">
    <script src="{{ url_for('static', filename='js/bootstrap-datepicker.min.js') }}"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.0.3/nouislider.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.0.3/nouislider.min.js"></script>

    <link rel="stylesheet" href="//cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css">
    <script src="//cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>

    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js"
            integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ"
            crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js"
            integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY"
            crossorigin="anonymous"></script>

</head>

<style>
    #cy {
        height: 66%;
        position: absolute;
        top: 0px;
        left: 200px;
        right: 0px;
        text-color: '#ffffff';
        background: rgb(177, 255, 243);
        border: 3px solid #ffffff;

    }

    div.form {
        position: absolute;
        left: 205px;
        right: 5px;
        top: 68%;
    }

    div.showDF {
        position: absolute;
        left: 205px;
        right: 5px;
        top: 68%;
    }

    div.absolute {
        position: absolute;
        top: 80px;
        right: 0;
        width: 200px;
        height: 100px;
    }
</style>

<body>
<!--
<div class="topnav">
  <a class="active" href="#home">Home</a>
  <a href="#news">News</a>
  <a href="#contact">Contact</a>
  <a href="#about">About</a>
</div> -->


<div id="sidenav" class="sidenav">
    <button class="dropdown-btn" ><i class="fas fa-server"></i> HIVE <i class="fa fa-caret-down"></i></button>
    <div class="dropdown-container">
        {% for database, tables in tables.items() %}
            <button class="dropdown-btn">  {{ database }} <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-container">
                {% for d in tables %}
                    <a href="#" onclick="addDataSource('{{ database }}.{{ d }}')">{{ d }}</a>
                {% endfor %}
            </div>
        {% endfor %}
    </div>

    <button class="dropdown-btn"><i class="fas fa-plus"></i> Add Datasource
        <i class="fa fa-caret-down"></i>
    </button>
    <div class="dropdown-container">
        <a href="#" onclick="addSQLDataSource()"><i class="fas fa-database"></i> Add SQL Database</a>
        <a href="#" onclick="uploadCSV()"><i class="fas fa-file-csv"></i> Upload CSV</a>
    </div>

    <button class="dropdown-btn">SQL-Functions
        <i class="fa fa-caret-down"></i>
    </button>
    <div class="dropdown-container">
        <a href="#" onclick="sqlSelect()">Select </a>
        <a href="#" onclick="sqlFilter()">Filter</a>
        <a href="#" onclick="sqlJoin()">Join</a>
        <a href="#" onclick="hqlSaveTable()">Save Table</a>
    </div>
    <button class="dropdown-btn">Vizualize
        <i class="fa fa-caret-down"></i>
    </button>
    <div class="dropdown-container">
        <a href="#" onclick="showTable()">Show Table</a>
        <a href="#" onclick="plot()">Scatter/Line Plot</a>
        <a href="#" onclick="plotHistogram()">Histogram Plot</a>
        <a href="#" onclick="ProbabilityPlot()">Survival Analysis</a>
    </div>
    <hr style="background-color : #818181">
    <button class="dropdown-btn">Kafka Topics
        <i class="fa fa-caret-down"></i>
    </button>
    <div class="dropdown-container">
        {% for t in topics %}
            <a href="#" onclick="addStreamingDataSource('{{ t }}')">{{ t }}</a>
        {% endfor %}
    </div>
    <button class="dropdown-btn">Streaming
        <i class="fa fa-caret-down"></i>
    </button>
    <div class="dropdown-container">
        <a href="#" onclick="windowedStream()">Window</a>
        <a href="#" onclick="vizualizeStream()">Visualize Stream</a>
        <a href="#" onclick="startStreaming()">Start Stream</a>
    </div>
</div>


<div class="main">
    <div id="cy"></div>
    <div id="form" class="form"></div>
    <div id='showDF'></div>
</div>


<script>

    var nodes = {{ nodes| tojson }};
    var edges = {{ edges| tojson }};


    var count = 1;

    var cy = cytoscape({
        container: document.getElementById('cy'),

        style: cytoscape.stylesheet()
            .selector('node')
            .css({
                'label': "data(label)",
                'height': 80,
                'width': 80,
                'border-color': '#000',
                'border-width': 3,
                'border-opacity': 0.5,
                'background-color': '#ffffff',
                'text-color': '#ffffff',
                'text-wrap': 'wrap',
                'text-halign': 'center',
                'text-valign': 'center'
            })
            .selector(':selected').css({
                'overlay-color': 'blue',
                'overlay-opacity': 0.5,
                'overlay-padding': 5
            })
            .selector('edge')
            .css({
                'curve-style': 'bezier',
                'target-arrow-shape': 'triangle',
                'line-color': '#ffaaaa',
                'target-arrow-color': '#ffaaaa'
            }),
        boxSelectionEnabled: true
    });


    nodes.forEach(function (node, index) {
        cy.add([{group: 'nodes', data: node}]);
    });
    edges.forEach(function (edge, index) {
        cy.add([{group: 'edges', data: edge}]);
    });

    let layout = cy.layout({
        name: 'dagre',
        rankDir: "LR",
        directed: true,
        animate: true
    });
    layout.run();


    /**
     * ############################################### Utility functions#############################################*/


    /**
     * This function returns the selected elements from a Selectize.js UI
     * @param id Id of the Selectize.js Element
     */
    function getSelectize(id) {

        let selectize = $(id)[0].selectize;

        let options = selectize.options;
        let items = selectize.items;
        let columns = $.map(items, function (value) {
            return options[value];
        });
        let selection = columns.map(x => x.label);
        return selection;
    }

    /**
     * Create a Selectize.js-UI given an Id and an array
     */
    function createSelectize(id, array, create = false, maxItems = null) {
        var options = [];
        array.forEach(function (val, idx) {
            options.push({id: idx, label: val});
        });

        var selectizeInput = $('#' + id).selectize({
            maxItems: maxItems,
            valueField: 'id',
            labelField: 'label',
            searchField: 'label',
            options: options,
            create: create
        });
    }

    /**
     * This function returns the selected value from a <select> element
     * @param id Id of the Select-Element
     */
    function getSelect(id) {
        let UI = document.getElementById(id);
        let selectedValue = UI.options[UI.selectedIndex].value;
        return selectedValue;

    }

    function removeElement(id) {
        document.getElementById(id).remove();
    }

    function removeFilter(id, inputIDs) {
        delete inputIDs[id];
        removeElement(id);
    }

    function visualizeResponse(response) {
        node = JSON.parse(response.node);
        edges = JSON.parse(response.edges);
        cy.add([{group: 'nodes', data: node}]);
        edges.forEach(function (edge, index) {
            cy.add([{group: 'edges', data: edge}]);
        });
        let layout = cy.layout({
            name: 'dagre',
            rankDir: "LR",
            directed: true,
            animate: true
        });
        layout.run();
    }

    function timestamp(str) {
        return new Date(str).getTime();
    }

    function formatDate(date) {
        let d = new Date(date),
            month = '' + (d.getMonth() + 1),
            day = '' + d.getDate(),
            year = d.getFullYear();

        if (month.length < 2)
            month = '0' + month;
        if (day.length < 2)
            day = '0' + day;

        return [year, month, day].join('-');
    }

    function trunc(string, n) {
        return (string.length > n) ? string.substr(0, n - 1) + '...' : string;
    }

    /**
     * Swap UI places of elements
     * @param a Id of first element
     * @param b Id of second element
     */
    function swap(a, b) {
        a = $(a);
        b = $(b);
        var tmp = $('<span>').hide();
        a.before(tmp);
        b.before(a);
        tmp.replaceWith(b);
    }

    function clear(id) {
        const ui = document.getElementById(id);
        while (ui.firstChild) {
            ui.removeChild(ui.firstChild);
        }

    }

    /** ############################################### END Utility functions########################################*/


    /**
     * ########################################################################################################
     *              The following code contains functions used for defining data sources and sinks
     *              and data tranformations
     * ########################################################################################################
     */

    /**
     * This function is triggered by a click on a data source.
     * Given the id of the data source it generates a source for all following
     * operations.
     * @param id The name of Hive table
     */
    function addDataSource(id) {
        $.post("addDataSource", {id: id}, function (response, status) {
            visualizeResponse(response)
        });
    }

    /**
     * This function is triggered by a click on a streaming data source.
     * Given the id of the data source it generates a source for all following streaming
     * operations.
     * @param id The name of Kafka topic
     */
    function addStreamingDataSource(id) {
        $.post("addStreamingDataSource", {id: id}, function (response, status) {
            visualizeResponse(response)
        });
    }

    /**
     * Add a SQL table as data source to the graph
     * @param connection_id
     * @param table_name
     */
    function addSQLTable(connection_id, table_name) {
        $.post("addSQLTable", {connection_id: connection_id, table_name: table_name},
            (response, status) => visualizeResponse(response));
    }

    /**
     * This function creates visual prog. component to establish a connection
     * to a remote SQL-Database. The tables in the database are added to the sidenav
     * and can be selected as data sources.
     */
    function addSQLDataSource() {

        // remove previous UI
        clear("form");

        let sqlUI = document.createElement("div");
        sqlUI.innerHTML = `<form>
                              <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                  <span class="input-group-text"><i class="fas fa-server"></i></span>
                                </div>
                                <input type="text" id="host" class="form-control" placeholder="example.com:port/database">
                              </div>

                              <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                  <span class="input-group-text"><i class="fas fa-user"></i></span>
                                </div>
                                <input type="text" id ="username" class="form-control" placeholder="Username">
                              </div>

                              <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                  <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                </div>
                                <input type="password" id="password" class="form-control" placeholder="Password">
                              </div>

                              <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                  <span class="input-group-text"><i class="fas fa-database"></i></span>
                                </div>
                                <select class="custom-select" id="databasetype">
                                    <option value="" selected disabled>Please select type of SQL-Database</option>
                                    <option>MySQL</option>
                                    <option>PostgreSQL</option>
                                </select>
                              </div>
                            <button type="submit" id="connectSQL" class="btn btn-primary">Connect</button>
                           </form>`;

        document.getElementById("form").appendChild(sqlUI);

        function SQLConnect() {
            let host = document.getElementById("host").value;
            let username = document.getElementById("username").value;
            let password = document.getElementById("password").value;
            let sql_type = getSelect("databasetype");

            $.post("sqlConnect", {host: host, username: username, password: password, sql_type: sql_type},
                function (response, status) {

                    // Get Tables in database
                    let tables = response[0];

                    //get connection id
                    let connection_id = response[1];

                    // Get Sidenav Element
                    let sidenav = document.getElementById("sidenav");

                    // Create separation line
                    let hr = document.createElement("HR");
                    hr.style.backgroundColor = "#818181";
                    sidenav.appendChild(hr);

                    // create dropdown-button
                    let databaseBTN = document.createElement("BUTTON");
                    databaseBTN.classList.add("dropdown-btn");
                    databaseBTN.innerHTML = `${host} <i class="fa fa-caret-down"></i>`;
                    sidenav.appendChild(databaseBTN);

                    // create container for dropdown-elements
                    let databaseDIV = document.createElement("div");
                    databaseDIV.classList.add("dropdown-container");


                    // creates list elements:  <a href="#" onclick="sqlSelect()"> tableName </a>
                    // and appends them to dropdown-container
                    tables.forEach(function (tableName, idx) {
                        let tableUI = document.createElement("a");
                        tableUI.setAttribute('href', "#");
                        tableUI.innerHTML = tableName;
                        tableUI.onclick = () => addSQLTable(connection_id, tableName);

                        databaseDIV.appendChild(tableUI);
                    });

                    // add dropdown-container to sidenav
                    sidenav.appendChild(databaseDIV);

                    // add toggle to dropdown-button
                    databaseBTN.addEventListener("click", function () {
                        this.classList.toggle("active");
                        let dropdownContent = this.nextElementSibling;
                        if (dropdownContent.style.display === "block") {
                            dropdownContent.style.display = "none";
                        } else {
                            dropdownContent.style.display = "block";
                        }
                    });

                });
        }

        $("#connectSQL").click(SQLConnect);


    }

    /**
     * This function creates creates an UI for Uploading a CSV.
     */
    function uploadCSV() {
        // remove previous UI
        clear("form");

        let uploadUI = document.createElement("div");

        uploadUI.innerHTML = `<form action="upload.html" method="post" enctype="multipart/form-data">
                                  <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                      <span class="input-group-text"><i class="fas fa-server"></i></span>
                                    </div>
                                    <input type="text" name="name" id="name" class="form-control" placeholder="Name">
                                  </div>

                                  <div class="input-group mb-3">
                                      <div class="custom-file">
                                        <input type="file" class="custom-file-input" id="file" name="file">
                                        <label class="custom-file-label" for="customFile">Choose file</label>
                                      </div>
                                  </div>
                                  <button type="submit" id="submit" class="btn btn-primary">Submit</button>
                              </form>`;
        document.getElementById("form").appendChild(uploadUI);
    }

    // ############################################# SQL-Functions ############################################

    /**
     * Show a sample from a selected table
     */
    function showTable() {
        let selected = cy.$(':selected').jsons();
        if (selected.length != 1) return;

        let id = selected[0].data.id;
        $.post("showTable", {id: id}, function (response, status) {
            columns = response;
            document.getElementById("form").innerHTML = response;

            $(document).ready(function () {
                $('#table').DataTable({
                    "scrollX": true,
                    "scrollY": true,
                });
            });
        });
    }

    /**
     *  This simulates projection. SQL-function: SELECT ... FROM table
     */
    function sqlSelect() {
        let selected = cy.$(':selected').jsons();
        if (selected.length != 1) return;

        let id = selected[0].data.id;

        const form = document.getElementById("form");
        while (form.firstChild) {
            form.removeChild(form.firstChild);
        }

        $.post("sqlSelect", {id: id}, function (response, status) {
            console.log("response:" + response);
            columns = response;
            //TODO: Exception handling

            // Selection box with description text for selecting columns
            var select = document.createElement("div");
            select.id = "selectize";
            let text1 = document.createElement("H2");
            text1.appendChild(document.createTextNode("Select columns for projection:"));
            document.getElementById("form").appendChild(text1);
            document.getElementById("form").appendChild(select);

            // Selection box with description text for renaming columns
            var rename = document.createElement("div");
            rename.id = "rename";
            let text2 = document.createElement("H2");
            text2.appendChild(document.createTextNode("(Optional) Rename selected columns:"));

            document.getElementById("form").appendChild(text2);
            document.getElementById("form").appendChild(rename);
            //new BstrapModal("Custom Titel", "BLABLA").Show();

            var options = [];
            columns.forEach(function (val, idx) {
                options.push({id: idx, label: val});
            });

            var selectizeInput = $('#selectize').selectize({
                maxItems: null,
                valueField: 'id',
                labelField: 'label',
                searchField: 'label',
                options: options,
                create: false
            });

            var n = columns.length;
            var renameInput = $('#rename').selectize({
                maxItems: null,
                valueField: 'id',
                labelField: 'label',
                searchField: 'label',
                options: options,
                create: function (val) {
                    columns.push(val);
                    return {id: n++, label: val};
                }
            });

            function sqlSelectResponse() {
                //$.post("sqlSelectResponse", {id: id}, function (response, status) {});
                var ids = selectizeInput[0].selectize.getValue();
                var labels = columns.filter(function (currentValue, index) {
                    return ids.includes(index);
                });
                ids = renameInput[0].selectize.getValue();

                var selectize = renameInput[0].selectize;
                var rename_objects = $.map(selectize.items, function (value) {
                    return selectize.options[value];
                });
                var rename = rename_objects.map(x => x.label);

                //TODO:  Send Response and change visualization of graph
                $.post("sqlSelectResponse", {
                    columns: JSON.stringify(labels),
                    rename: JSON.stringify(rename),
                    id: id
                }, function (response, status) {
                    visualizeResponse(response);

                });
            }

            var button = document.createElement("input");
            button.type = "button";
            button.name = "add";
            button.value = "Submit";
            button.className = "btn btn btn-primary";
            button.onclick = sqlSelectResponse;
            document.getElementById('form').appendChild(button);

        });

    }

    /**
     * This function is triggered by clicking on "Filter".
     * An UI is dynamically created for a filtering a selected Data Frame.
     */
    function sqlFilter() {

        // Get selected Nodes
        let selected = cy.$(':selected').jsons();
        if (selected.length != 1) return;
        let id = selected[0].data.id;

        //remove previous UI elements
        const form = document.getElementById("form");
        while (form.firstChild) {
            form.removeChild(form.firstChild);
        }

        $.post("sqlFilter", {id: id}, function (response, status) {

            var columns = Object.keys(response);
            var types = Object.values(response);

            //TODO: Exception handling
            // Selection box with description text for selecting
            var div = document.createElement("div");
            div.id = "filterUI";

            // create a selectize for selecting columns
            var filters = document.createElement("div");
            filters.id = "filtersSelection";

            filters.innerHTML = `<h1> Select columns to be filtered: </h1>
                                  <div class="input-group mb-3">
                                      <select class="custom-select" id='filter-columns'></select>
                                    <div class="btn-group" role="group">
                                      <select class="custom-select" id='filter-type'>
                                          <option selected>Predefined Filter</option>
                                          <option >Selectize</option>
                                          <option>Range Slider</option>
                                          <option>Date Slider</option>
                                      </select>
                                     <button id='addFilter' class="btn btn btn-primary" type="button">ADD</button>
                                    </div>
                                  </div>
                                 </div>`;
            div.appendChild(filters);
            document.getElementById("form").appendChild(div);

            // add options to select-input
            let selectList = document.getElementById("filter-columns");
            for (var i = 0; i < columns.length; i++) {
                var option = document.createElement("option");
                option.value = columns[i];
                option.text = columns[i];
                selectList.appendChild(option);
            }


            let inputIDs = {};

            /**
             *  Dynamically adds filter. The type of the filter
             *  depends on the corresponding data type.
             */
            function addFilter() {

                let filterID = "condition" + (++filterCount);
                // Get selected column to be filtered

                let columnSelection = document.getElementById("filter-columns");
                let column = columnSelection.options[columnSelection.selectedIndex].value;

                let filterTypeSelection = document.getElementById("filter-type");
                let filterType = filterTypeSelection.options[filterTypeSelection.selectedIndex].value;

                let div = document.createElement("div");
                div.id = filterID;

                let columnName = document.createElement("Label");
                columnName.innerHTML = column;
                div.style.cssText = "  padding: 2px;";
                div.appendChild(columnName);

                if (filterType === "Predefined Filter") {
                    let dataType = response[column];

                    // Ids for dynamically added UI-Elements
                    let conditionID = filterID + "-condition";
                    let optionsID = filterID + "-option";
                    let removeID = filterID + "-remove";

                    // create a text input if the data type is a string
                    if (dataType === "string") {
                        div.innerHTML = `<label> ${column} </label>
                                  <div class="input-group mb-3">
                                    <input id='${conditionID}' type="text" class="form-control" placeholder="Insert Filter Condition" aria-describedby="basic-addon2">
                                    <div class="btn-group" role="group">
                                      <select class="custom-select" id='${optionsID}'>
                                        <option value="RegEx">RegEx</option>
                                        <option value="Custom">Custom</option>
                                      </select>
                                     <button id='${removeID}' class="btn btn-danger" type="button">Remove</button>
                                    </div>
                                  </div>
                                 </div>`;
                        document.getElementById("filterUI").appendChild(div);
                        document.getElementById(removeID).addEventListener("click", function () {
                            removeFilter(filterID, inputIDs);
                        });

                        inputIDs[filterID] = {
                            column: column,
                            type: "string",
                            inputs: [conditionID, optionsID]
                        };
                    }
                    //TODO: improve check for datatype
                    if (["int", "bigint", "double"].includes(dataType)) {
                        let lowerLimitID = conditionID + "-lower";
                        let upperLimitID = conditionID + "-upper";
                        let lowerOptionsID = optionsID + "-lower";
                        let upperOptionsID = optionsID + "-upper";

                        div.innerHTML = `<label> ${column} </label>
                                  <div class="input-group">
                                    <div class="btn-group" role="group">
                                      <select class="custom-select" id='${lowerOptionsID}'>
                                        <option value="[">[</option>
                                        <option value="(">(</option>
                                      </select>
                                     <input id='${lowerLimitID}' type="number" class="form-control" placeholder="-&#8734" aria-describedby="basic-addon2">
                                     <span class="input-group-text">,</span>
                                     <input id='${upperLimitID}' type="number" class="form-control" placeholder="&#8734" aria-describedby="basic-addon2">
                                      <select class="custom-select" id='${upperOptionsID}'>
                                        <option value="]">]</option>
                                        <option value=")">)</option>
                                      </select>
                                    </div>
                                     <button id='${removeID}' class="btn btn-danger" type="button">Remove</button>
                                  </div>
                                 </div>`;
                        document.getElementById("filterUI").appendChild(div);
                        document.getElementById(removeID).addEventListener("click", function () {
                            removeFilter(filterID, inputIDs);
                        });

                        inputIDs[filterID] = {
                            column: column,
                            type: "numerical",
                            inputs: [lowerLimitID, upperLimitID, lowerOptionsID, upperOptionsID]
                        };
                    }
                }
                if (filterType === "Selectize") {


                    let conditionID = filterID + "-condition";
                    let removeID = filterID + "-remove";

                    let dataType = response[column];
                    let div = document.createElement("div");
                    div.id = filterID;


                    $.post("sqlGetUnique", {
                        id: id, column: column
                    }, function (response, status) {
                        var filterSelection = response;

                        div.innerHTML = `<label> ${column} </label>
                                         <div class="input-group">
                                            <div id="${conditionID}" style="width:90%;"></div>
                                            <button id='${removeID}' class="btn btn-danger" type="button">Remove</button>
                                          </div>`;

                        document.getElementById("filterUI").appendChild(div);
                        document.getElementById(removeID).addEventListener("click", function () {
                            removeFilter(filterID, inputIDs);
                        });

                        var options = [];
                        filterSelection.forEach(function (val, idx) {
                            options.push({id: idx, label: val});
                        });

                        var selectizeInput = $('#' + conditionID).selectize({
                            maxItems: null,
                            valueField: 'id',
                            labelField: 'label',
                            searchField: 'label',
                            options: options,
                            create: false
                        });

                        inputIDs[filterID] = {
                            column: column,
                            type: "selectize",
                            inputs: [conditionID]
                        };
                    });


                }
                if (filterType === "Range Slider") {
                    let dataType = response[column];

                    if (!["int", "bigint", "double", "float"].includes(dataType)) {
                        return;
                    }

                    $.post("sqlGetRange", {
                        id: id, column: column
                    }, function (response, status) {
                        // Ids for dynamically added UI-Elements
                        let conditionID = filterID + "-condition";
                        let removeID = filterID + "-remove";
                        let sliderID = filterID + "-slider";
                        let lowerLimitID = conditionID + "-lower";
                        let upperLimitID = conditionID + "-upper";


                        div.innerHTML = `<label> ${column} </label>
                                            <div style="padding-bottom:5px;padding-left:5px;padding-right:5px;"><div id='${sliderID}'></div></div>
                                            <div class="input-group m3">
                                                <span class="input-group-text">Lower Bound:</span>
                                                <input id='${lowerLimitID}' type="number" class="form-control" placeholder="-&#8734;" aria-describedby="basic-addon2">
                                                <span class="input-group-text">Upper Bound:</span>
                                                <input id='${upperLimitID}' type="number" class="form-control" placeholder="&#8734;" aria-describedby="basic-addon2">
                                                <button id='${removeID}' class="btn btn-danger" type="button">Remove</button>
                                            </div>
                                            <hr>`;
                        document.getElementById("filterUI").appendChild(div);
                        document.getElementById(removeID).addEventListener("click", function () {
                            removeFilter(filterID, inputIDs);
                        });

                        let min = response[0];
                        let max = response[1];

                        var slider = document.getElementById(sliderID);

                        noUiSlider.create(slider, {
                            start: [min + 0.2 * (max - min), min + 0.8 * (max - min)],
                            connect: true,
                            range: {
                                'min': min,
                                'max': max
                            }
                        });

                        let inputLowerBound = document.getElementById(lowerLimitID);
                        let inputUpperBound = document.getElementById(upperLimitID);

                        //if the slider is updated change the inputs
                        slider.noUiSlider.on('update', function (values, handle) {
                            let value = values[handle];
                            if (handle) {
                                inputUpperBound.value = value;
                            } else {
                                inputLowerBound.value = value;
                            }
                        });

                        inputLowerBound.addEventListener('change', function () {
                            slider.noUiSlider.set([this.value, null]);
                        });

                        inputUpperBound.addEventListener('change', function () {
                            slider.noUiSlider.set([null, this.value]);
                        });

                        inputIDs[filterID] = {
                            column: column,
                            type: "range",
                            inputs: [lowerLimitID, upperLimitID]
                        };
                    });

                }
                if (filterType === "Date Slider") {
                    let dataType = response[column];

                    if (!["string", "date"].includes(dataType)) {
                        return;
                    }


                    $.post("sqlGetDateRange", {
                        id: id, column: column
                    }, function (response, status) {

                        let min = timestamp(response[0]);
                        let max = timestamp(response[1]);
                        // Ids for dynamically added UI-Elements
                        let conditionID = filterID + "-condition";
                        let removeID = filterID + "-remove";
                        let sliderID = filterID + "-slider";
                        let lowerLimitID = conditionID + "-lower";
                        let upperLimitID = conditionID + "-upper";

                        /**
                         *
                         */
                        div.innerHTML = `<label> ${column} </label>
                                  <div style="padding-bottom:5px;padding-left:5px;padding-right:5px;"><div id='${sliderID}'></div></div>
                                  <div class="input-group">
                                    <div class="btn-group" role="group">
                                     <span class="input-group-text">Lower Bound:</span>
                                        <input type='text' class="form-control" id='${lowerLimitID}' />
                                        <span class="input-group-text">Upper Bound:</span>
                                        <input type='text' class="form-control" id='${upperLimitID}' />
                                    </div>
                                     <button id='${removeID}' class="btn btn-danger" type="button">Remove</button>
                                    </div>
                                    <hr>`;

                        document.getElementById("filterUI").appendChild(div);
                        document.getElementById(removeID).addEventListener("click", function () {
                            removeFilter(filterID, inputIDs);
                        });
                        $(function () {
                            $('#' + lowerLimitID).datepicker({
                                format: 'yyyy-mm-dd',
                                startDate: formatDate(min),
                                endDate: formatDate(max)
                            })
                                .on("changeDate", function (e) {
                                    slider.noUiSlider.set([timestamp(e.date), null]);
                                });
                        });
                        $(function () {
                            $('#' + upperLimitID).datepicker({
                                format: 'yyyy-mm-dd',
                                startDate: formatDate(min),
                                endDate: formatDate(max)
                            })
                                .on("changeDate", function (e) {
                                    slider.noUiSlider.set([null, timestamp(e.date)]);
                                });
                        });


                        var slider = document.getElementById(sliderID);

                        noUiSlider.create(slider, {
                            start: [min + 0.2 * (max - min), min + 0.8 * (max - min)],
                            connect: true,
                            range: {
                                'min': min,
                                'max': max
                            }
                        });

                        let inputLowerBound = document.getElementById(lowerLimitID);
                        let inputUpperBound = document.getElementById(upperLimitID);

                        //if the slider is updated change the inputs
                        slider.noUiSlider.on('update', function (values, handle) {
                            let timestamp = parseInt(values[handle]);
                            let date = formatDate(timestamp);
                            if (handle) {
                                inputUpperBound.value = date;
                            } else {
                                inputLowerBound.value = date;
                            }
                        });


                        inputIDs[filterID] = {
                            column: column,
                            type: "rangeDate",
                            inputs: [lowerLimitID, upperLimitID]
                        };
                    });

                }

            }

            function sqlFilterResponse() {
                /**
                 Iterate over all conditions and generate a dictionary that will be send to the server.
                 Each data type creates a different dictionary used for filtering.
                 */
                let conditions = Object.keys(inputIDs).map(function (key, index) {
                        let elem = inputIDs[key];

                        // If the filter was created using the predefined option for string columns
                        if (elem.type === "string") {
                            let inputs = elem["inputs"];
                            let optionsSelection = document.getElementById(inputs[1]);
                            let option = optionsSelection.options[optionsSelection.selectedIndex].value;
                            let condition = document.getElementById(inputs[0]).value;
                            return {column: elem.column, condition: condition, option: option, type: "string"}
                        }

                        // If the filter was created using the predefined option for numerical values
                        if (elem.type === "numerical") {
                            let inputs = elem["inputs"];

                            let lowerBound = document.getElementById(inputs[0]).value;
                            let lowerBoundSelection = document.getElementById(inputs[2]);
                            let lowerBoundType = lowerBoundSelection.options[lowerBoundSelection.selectedIndex].value;

                            let upperBound = document.getElementById(inputs[1]).value;
                            let upperBoundSelection = document.getElementById(inputs[3]);
                            let upperBoundType = upperBoundSelection.options[upperBoundSelection.selectedIndex].value;

                            return {
                                column: elem.column,
                                lowerBoundType: lowerBoundType,
                                upperBoundType: upperBoundType,
                                lowerBound: lowerBound,
                                upperBound: upperBound,
                                type: "numerical"
                            };
                        }

                        if (elem.type === "range") {
                            let inputs = elem["inputs"];

                            let lowerBound = document.getElementById(inputs[0]).value;
                            let upperBound = document.getElementById(inputs[1]).value;

                            return {
                                column: elem.column,
                                lowerBoundType: "[",
                                upperBoundType: "]",
                                lowerBound: lowerBound,
                                upperBound: upperBound,
                                type: "numerical"
                            }

                        }
                        if (elem.type === "rangeDate") {
                            let inputs = elem["inputs"];

                            let lowerBound = document.getElementById(inputs[0]).value;
                            let upperBound = document.getElementById(inputs[1]).value;

                            return {
                                column: elem.column,
                                lowerBound: lowerBound,
                                upperBound: upperBound,
                                type: "rangeDate"
                            }

                        }

                        if (elem.type === "selectize") {
                            let selectedValues = getSelectize("#" + elem['inputs'][0]);
                            console.log(selectedValues);
                            return {
                                column: elem.column,
                                list: selectedValues,
                                type: "selectize"
                            }
                        }

                    }
                );

                console.log(conditions);

                $.post("sqlFilterResponse", {
                    id: id,
                    conditions: JSON.stringify(conditions)
                }, function (response, status) {
                    visualizeResponse(response)
                });

            }

            let filterCount = 0;
            let button = document.getElementById("addFilter");
            button.addEventListener("click", addFilter);

            let submit = document.createElement("input");
            submit.type = "button";
            submit.name = "submit";
            submit.value = "Submit";
            submit.className = "btn btn btn-success";
            submit.style.width = "80px";
            submit.addEventListener("click", sqlFilterResponse);
            document.getElementById('form').appendChild(submit);

        })
    }

    /**
     * This function is the visual programming component for SQL-Joins.
     * The user can select key-columns and the type of join operation.
     */
    function sqlJoin() {
        let selected = cy.$(':selected').jsons();
        if (selected.length != 2) return;

        let table_name_1 = trunc(selected[0].data.label, 20);
        let table_id_1 = selected[0].data.id;
        let table_name_2 = trunc(selected[1].data.label, 20);
        let table_id_2 = selected[1].data.id;

        const form = document.getElementById("form");
        while (form.firstChild) {
            form.removeChild(form.firstChild);
        }

        $.post("sqlJoin", {id_1: table_id_1, id_2: table_id_2},
            function (response, status) {
                console.log(response);

                let joinUI = document.createElement("div");

                let swapped = false;

                function swapTables() {
                    swap('#TableLeft', '#TableRight');
                    if (!swapped) {
                        document.getElementById("LeftLabel").innerText = `Right Table: ${table_name_1}`;
                        document.getElementById("RightLabel").innerText = `Left Table: ${table_name_2}`;
                        swapped = true;
                    } else {
                        document.getElementById("LeftLabel").innerText = `Left Table: ${table_name_1}`;
                        document.getElementById("RightLabel").innerText = `Right Table: ${table_name_2}`;
                        swapped = false;
                    }
                }

                joinUI.innerHTML = `<div class="row">
                                      <div class="col-10">
                                          <div id="TableLeft" >
                                            <label id="LeftLabel">Left Table: ${table_name_1}</label>
                                            <div id="joinSelectize1"></div>
                                          </div>
                                          <div id="TableRight">
                                            <label id="RightLabel">Right Table: ${table_name_2}</label>
                                            <div id="joinSelectize2"></div>
                                          </div>
                                      </div>
                                      <div class="col-1"style="display: flex; justify-content: center; align-items: center;">
                                        <button id="swapTables" class="btn btn-primary center-block"><i class="fas fa-exchange-alt fa-rotate-90"></i></button>
                                      </div>
                                    </div>
                                    <div class="row">
                                        <div class="col">
                                        <label>Type of Join</label>
                                        <select id="joinType" class="form-control">
                                          <option>LEFT OUTER JOIN</option>
                                          <option>RIGHT OUTER JOIN</option>
                                          <option>FULL OUTER JOIN</option>
                                          <option>INNER JOIN</option>
                                          <option>LEFT SEMI JOIN</option>
                                          <option>LEFT ANTI JOIN</option>
                                        </select>
                                      </div>
                                    </div>
                                    <div class="row">
                                    <div class="col">
                                        <button id="sqlJoinSubmit" type="submit" class="btn btn-primary">Submit</button>
                                        </div>
                                    </div>`;


                document.getElementById("form").appendChild(joinUI);

                // Create Selectize for first table
                let columns1 = response[0];
                let options = [];
                columns1.forEach(function (val, idx) {
                    options.push({id: idx, label: val});
                });
                $("#joinSelectize1").selectize({
                    placeholder: "Select key-columns for join...",
                    maxItems: null,
                    valueField: 'id',
                    labelField: 'label',
                    searchField: 'label',
                    options: options,
                    create: false
                });

                // Create Selectize for second table
                let columns2 = response[1];
                options = [];
                columns2.forEach(function (val, idx) {
                    options.push({id: idx, label: val});
                });
                $("#joinSelectize2").selectize({
                    placeholder: "Select key-columns for join...",
                    maxItems: null,
                    valueField: 'id',
                    labelField: 'label',
                    searchField: 'label',
                    options: options,
                    create: false
                });

                function sqlJoinResponse() {

                    // Set parameters but consider swapping of left and right table
                    let columns1 = (!swapped ? getSelectize("#joinSelectize1") : getSelectize("#joinSelectize2"));
                    let columns2 = (!swapped ? getSelectize("#joinSelectize2") : getSelectize("#joinSelectize1"));
                    let id_1 = (!swapped ? table_id_1 : table_id_2);
                    let id_2 = (!swapped ? table_id_2 : table_id_1);
                    let join_type = getSelect("joinType");
                    $.post("sqlJoinResponse", {
                        id_1: id_1, join_columns_1: JSON.stringify(columns1),
                        id_2: id_2, join_columns_2: JSON.stringify(columns2),
                        join_type: join_type
                    }, function (response, status) {
                        visualizeResponse(response)
                    });
                }

                $("#sqlJoinSubmit").click(sqlJoinResponse);
                $("#swapTables").click(swapTables);

            })
    }


    /**
     * Save selected table in Hive
     */
    function hqlSaveTable() {
        let selected = cy.$(':selected').jsons();
        if (selected.length != 1) return;

        let id = selected[0].data.id;
        clear("form");

        let saveUI = document.createElement("div");
        saveUI.innerHTML = `<form>
                              <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                  <span class="input-group-text">Table Name</span>
                                </div>
                                <input type="text" id="tableName" class="form-control" placeholder="Insert Name for Table">
                              </div>
                             <div class="form-group">
                                    <div class="input-group">
                                    <div class="input-group-prepend">
                                      <span class="input-group-text"><i class="fas fa-server"></i></span>
                                    </div>
                                      <select class="form-control" id="dbs">
                                        <option value="">Select a database...</option>
                                        {% for database, tables in tables.items() %}
                                        <option> {{ database }} </option>
                                        {% endfor %}
                                      </select>
                                    </div>
                                  </div>
                            <button type="submit" id="saveHQL" class="btn btn-primary">Submit</button>
                           </form>`;
        document.getElementById("form").appendChild(saveUI);

        // $.post("hqlSaveTable", {id: id},(res,val)=>visualizeResponse(res));
        $("#saveHQL").click(() => {
            let selectedDB = getSelect("dbs");
            let name = document.getElementById("tableName").value;
            let databases = {{ tables |tojson }};

            if (databases[selectedDB].includes(name)) {
                alert("Table with the same name already exists");
                return;
            }

            $.post("hqlSaveTable", {id: id, db: selectedDB, name: name}, {});
        });


    }
</script>
<script>
    // ############################ END: Streaming-Functions ############################

    /**
     * This function plots a line-plot for a selected stream.
     */
    function vizualizeStream() {
        let selected = cy.$(':selected').jsons();
        if (selected.length != 1) return;

        let id = selected[0].data.id;
        $.post("vizualizeStream", {id: id}, function (response, status) {
            visualizeResponse(response)
        });
    }

    /**
     * This function applies a window function on a stream.
     * The user can choose the parameters of the window
     * and the type of aggregation.
     */
    function windowedStream() {
        let selected = cy.$(':selected').jsons();
        if (selected.length != 1) return;

        let id = selected[0].data.id;

        const form = document.getElementById("form");
        while (form.firstChild) {
            form.removeChild(form.firstChild);
        }

        let windowUIDiv = document.createElement("div");
        windowUIDiv.id = "windowStreamUI";
        windowUIDiv.innerHTML = `<label>Define Window Function</label>
                                  <div class="input-group mb-3">
                                      <div class="input-group-prepend">
                                        <span class="input-group-text">Window Length</span>
                                      </div>
                                      <input id="windowLength" type="number" class="form-control" >
                                      <div class="input-group-prepend">
                                        <span class="input-group-text">Sliding Interval</span>
                                      </div>
                                      <input id="windowInterval" type="number" class="form-control" >
                                      <select class="form-control" id="aggregationFunction">
                                        <option>Sum</option>
                                        <option>Mean</option>
                                        <option>Min</option>
                                        <option>Max</option>
                                      </select>
                                      <button id="windowStreamSubmit" type="submit" class="btn btn-primary">Submit</button>
                                  </div>`;
        form.appendChild(windowUIDiv);

        function windowedStreamResponse() {
            let windowLength = document.getElementById("windowLength").value;
            let windowInterval = document.getElementById("windowInterval").value;

            let aggregationFunctionUI = document.getElementById("aggregationFunction");
            let aggregationFunction = aggregationFunctionUI.options[aggregationFunctionUI.selectedIndex].value;

            $.post("windowedStreamResponse", {
                    id: id,
                    windowLength: windowLength,
                    windowInterval: windowInterval,
                    aggregationFunction: aggregationFunction
                },
                function (response, status) {
                    visualizeResponse(response)
                });

        }

        let button = document.getElementById("windowStreamSubmit");
        button.addEventListener("click", windowedStreamResponse);

    }


    function startStreaming() {
        $.post("startStreaming", (response, status) => {
        });
    }

    // ############################ Vizualization ############################

    function plot() {
        clear("form");
        let selected = cy.$(':selected').jsons();
        if (selected.length != 1) return;
        let id = selected[0].data.id;

        $.post("getColumns", {id: id}, function (response, status) {

            var columns = Object.keys(response);
            var types = Object.values(response);
            console.log(columns);
            console.log(types);

            let plotUI = document.createElement("div");

            plotUI.innerHTML = `<div>
                                     <div class="mb">
                                            <label>Select columns for x</label>
                                            <div id="xValues"></div>
                                      </div>
                                     <div class="mb">
                                            <label>Select columns for y</label>
                                            <div id="yValues"></div>
                                      </div>

                                     <div class="mb-3">
                                        <label>Select plot type</label>
                                        <select id="plotType" class="form-control">
                                          <option>Scatter Plot</option>
                                          <option>Line Plot</option>
                                        </select>
                                      </div>

                                      <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                          <span class="input-group-text">Title</span>
                                        </div>
                                        <input type="text" id="plotTitle" class="form-control" placeholder="Title of Plot">
                                      </div>

                                      <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                          <span class="input-group-text">x-Axis Label</span>
                                        </div>
                                        <input type="text" id="xAxis" class="form-control" placeholder="Label for x-axis">
                                      </div>

                                      <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                          <span class="input-group-text">y-Axis Label</span>
                                        </div>
                                        <input type="text" id="yAxis" class="form-control" placeholder="Label for y-axis">
                                      </div>

                                      <button type="submit" id="submitPlot" class="btn btn-primary">Submit</button>
                                </div>`;
            document.getElementById("form").appendChild(plotUI);
            createSelectize("xValues", columns, false, null);
            createSelectize("yValues", columns, false, null);

            function submitPlot() {
                let xColumns = getSelectize("#xValues");
                let yColumns = getSelectize("#yValues");

                let plotType = getSelect("plotType");
                let title = document.getElementById("plotTitle").value;
                let xAxisLabel = document.getElementById("xAxis").value;
                let yAxisLabel = document.getElementById("yAxis").value;


                $.post("submitPlot", {
                        id: id, xColumns: JSON.stringify(xColumns), yColumns: JSON.stringify(yColumns),
                        title: title, xAxisLabel: xAxisLabel, yAxisLabel: yAxisLabel,
                        plotType: plotType
                    },
                    function (response, status) {
                        visualizeResponse(response)
                    });
            }

            $("#submitPlot").click(submitPlot);

        });


    }

    function plotHistogram() {
        clear("form");
        let selected = cy.$(':selected').jsons();
        if (selected.length != 1) return;
        let id = selected[0].data.id;

        $.post("getColumns", {id: id}, function (response, status) {

            var columns = Object.keys(response);
            var types = Object.values(response);
            console.log(columns);
            console.log(types);

            let plotUI = document.createElement("div");

            plotUI.innerHTML = `<div>
                                     <div class="mb">
                                            <label>Select columns for Histogram</label>
                                            <div id="xValues"></div>
                                      </div>
                                      <div class="input-group mb-3">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">Number of Bins</span>
                                            </div>
                                            <input id='bins' type="number" class="form-control" aria-describedby="basic-addon2">
                                      </div>
                                      <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                          <span class="input-group-text">Title</span>
                                        </div>
                                        <input type="text" id="plotTitle" class="form-control" placeholder="Title of Plot">
                                      </div>

                                      <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                          <span class="input-group-text">x-Axis Label</span>
                                        </div>
                                        <input type="text" id="xAxis" class="form-control" placeholder="Label for x-axis">
                                      </div>

                                      <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                          <span class="input-group-text">y-Axis Label</span>
                                        </div>
                                        <input type="text" id="yAxis" class="form-control" placeholder="Label for y-axis">
                                      </div>

                                      <button type="submit" id="submitPlot" class="btn btn-primary">Submit</button>
                                </div>`;
            document.getElementById("form").appendChild(plotUI);
            createSelectize("xValues", columns, false, 1);

            function submitPlot() {
                let xColumns = getSelectize("#xValues");

                let bins = document.getElementById("bins").value;
                let title = document.getElementById("plotTitle").value;
                let xAxisLabel = document.getElementById("xAxis").value;
                let yAxisLabel = document.getElementById("yAxis").value;


                $.post("submitHistPlot", {
                        id: id, xColumns: JSON.stringify(xColumns), bins: bins,
                        title: title, xAxisLabel: xAxisLabel, yAxisLabel: yAxisLabel,
                    },
                    function (response, status) {
                        visualizeResponse(response)
                    });
            }

            $("#submitPlot").click(submitPlot);
        });
    }


    function ProbabilityPlot() {
        clear("form");
        let selected = cy.$(':selected').jsons();
        if (selected.length != 1) return;
        let id = selected[0].data.id;

        $.post("getColumns", {id: id}, function (response, status) {

            var columns = Object.keys(response);
            var types = Object.values(response);


            let plotUI = document.createElement("div");

            plotUI.innerHTML = `
                                  <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Failure Data</span>
                                    </div>
                                    <select class="custom-select" id='failureCol'></select>
                                  </div>

                                  <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">Censored Data</span>
                                    </div>
                                    <select class="custom-select" id='censCol'>
                                          <option selected>Not Censored</option>
                                    </select>
                                  </div>


                                  <div class="mb-3">
                                      <label>Select Distribution for Estimation</label>
                                      <div id="selectEstimator"></div>
                                  </div>

                                 <button type="submit" id="submitPlot" class="btn btn-primary">Submit</button>`;
            document.getElementById("form").appendChild(plotUI);

            let distributions = ["Weibull 2-Param","Weibull 3-Param","LogNormal 2-Param","LogNormal 3-Param"];
            createSelectize("selectEstimator",distributions);


            let failureSelect = document.getElementById("failureCol");
            for (var i = 0; i < columns.length; i++) {
                var option = document.createElement("option");
                option.value = columns[i];
                option.text = columns[i];
                failureSelect.appendChild(option);
            }

            let censSelect = document.getElementById("censCol");
            for (var i = 0; i < columns.length; i++) {
                var option = document.createElement("option");
                option.value = columns[i];
                option.text = columns[i];
                censSelect.appendChild(option);
            }



            function submitPlot() {
                let failureCol = getSelect("failureCol");
                let censCol = getSelect("censCol");
                let dists = getSelectize("#selectEstimator");

                $.post("submitSurvivalPlot", {
                        id: id, failureCol: failureCol, censCol: censCol,
                        dists: JSON.stringify(dists)
                    },
                    function (response, status) {
                        visualizeResponse(response)
                    });
            }

            $("#submitPlot").click(submitPlot);
        });

    }
</script>

<script>
    /* Loop through all dropdown buttons to toggle between hiding and showing its dropdown content - This allows the user to have multiple dropdowns without any conflict */
    function activateDropdowns() {
        let dropdown = document.getElementsByClassName("dropdown-btn");
        let i;

        for (i = 0; i < dropdown.length; i++) {
            dropdown[i].addEventListener("click", function () {
                this.classList.toggle("active");
                let dropdownContent = this.nextElementSibling;
                if (dropdownContent.style.display === "block") {
                    dropdownContent.style.display = "none";
                } else {
                    dropdownContent.style.display = "block";
                }
            });
        }

    }

    activateDropdowns();
</script>

</body>
</html>